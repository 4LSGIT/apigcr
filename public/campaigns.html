<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Campaigns</title>

  <link href="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.snow.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.min.js"></script>

  <style>
    body { font-family: Arial, Helvetica, sans-serif; text-align:center; }

    input, select, textarea {
      width: 220px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 3px;
    }

    .input-label {
      font-weight: bold;
      margin-top: 10px;
      margin-bottom: 5px;
    }

    .big-button {
      padding: 10px 20px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      width: 180px;
    }

    .big-button:hover { background:#0056b3; }

    .campaign-hidden { display:none; }

    .quill-editor .ql-container {
      height: 280px;
      border-radius: 3px;
    }

    #subject-hint {
      font-size: 12px;
      margin-top: 4px;
    }
  </style>
</head>

<body>

<h2>Campaigns</h2>

<div id="campaign-tab-compose">
  <div class="campaign-form">

    <!-- Campaign type -->
    <div>
      <label><input type="radio" name="campaign-type" value="sms"> SMS</label>
      <label><input type="radio" name="campaign-type" value="simple-email" checked> Simple Email</label>
      <label><input type="radio" name="campaign-type" value="html-email"> HTML Email</label>
    </div>

    <!-- Sender -->
    <div id="campaign-email-sender">
      <div class="input-label">From Email</div>
      <select id="campaign-email-address">
        <option value="">Select email</option>
        <option value="info@example.com">info@example.com</option>
        <option value="support@example.com">support@example.com</option>
      </select>
    </div>

    <!-- SUBJECT -->
    <div id="campaign-subject-fields">
      <div class="input-label">Email Subject</div>
      <div style="display:flex; justify-content:center; gap:6px;">
        <input
          id="campaign-email-subject"
          type="text"
          maxlength="150"
          placeholder="Enter subject"
        >
        <button type="button" id="emoji-btn">ðŸ˜€</button>
      </div>
      <div id="subject-hint"></div>
    </div>

    <!-- SIMPLE EMAIL BODY -->
    <div id="campaign-simple-body-fields">
      <div class="input-label">Email Body</div>
      <div id="campaign-email-body-editor" class="quill-editor"></div>
    </div>

    <!-- HTML EMAIL BODY -->
    <div id="campaign-html-body-fields" class="campaign-hidden">
      <div class="input-label">HTML Body</div>
      <textarea id="campaign-html-body" rows="8" placeholder="Paste HTML here"></textarea>
    </div>

    <!-- SCHEDULE -->
    <div style="margin-top:10px;">
      <label>
        <input type="checkbox" id="campaign-send-now" checked>
        Send now
      </label>
      <div id="campaign-schedule-field" class="campaign-hidden">
        <input type="datetime-local" id="campaign-schedule">
      </div>
    </div>

    <button class="big-button" onclick="campaignScheduleCampaign()">Create Campaign</button>
  </div>
</div>

<script>
  const E = id => document.getElementById(id);

  let quillBody = null;

  document.addEventListener('DOMContentLoaded', () => {
    quillBody = new Quill('#campaign-email-body-editor', {
      theme: 'snow',
      modules: {
        toolbar: [
          ['bold','italic','underline'],
          [{ list:'ordered' },{ list:'bullet' }],
          ['link','image']
        ]
      }
    });

    document.querySelectorAll('input[name="campaign-type"]').forEach(r =>
      r.addEventListener('change', toggleFields)
    );

    E('campaign-send-now').addEventListener('change', toggleSchedule);
    E('campaign-email-subject').addEventListener('input', updateSubjectHint);

    E('emoji-btn').addEventListener('click', () => {
      const emoji = prompt('Paste an emoji ðŸ™‚');
      if (!emoji) return;
      const i = E('campaign-email-subject');
      const pos = i.selectionStart;
      i.value = i.value.slice(0,pos) + emoji + i.value.slice(pos);
      updateSubjectHint();
    });

    toggleFields();
    toggleSchedule();
    updateSubjectHint();
  });

  function toggleFields() {
    const type = document.querySelector('input[name="campaign-type"]:checked').value;
    E('campaign-simple-body-fields').classList.toggle('campaign-hidden', type !== 'simple-email');
    E('campaign-html-body-fields').classList.toggle('campaign-hidden', type !== 'html-email');
  }

  function toggleSchedule() {
    E('campaign-schedule-field').classList.toggle(
      'campaign-hidden',
      E('campaign-send-now').checked
    );
  }

  function updateSubjectHint() {
    const len = E('campaign-email-subject').value.length;
    const hint = E('subject-hint');

    if (len <= 60) {
      hint.textContent = `${len}/150 â€” good length`;
      hint.style.color = 'green';
    } else if (len <= 90) {
      hint.textContent = `${len}/150 â€” may truncate on mobile`;
      hint.style.color = 'orange';
    } else {
      hint.textContent = `${len}/150 â€” high risk of truncation`;
      hint.style.color = 'red';
    }
  }

  function campaignScheduleCampaign() {
    const type = document.querySelector('input[name="campaign-type"]:checked').value;
    const sender = E('campaign-email-address').value;
    const subject = E('campaign-email-subject').value.trim();

    if (!sender || !subject) {
      alert('Sender and subject are required');
      return;
    }

    let body = '';
    if (type === 'simple-email') body = quillBody.root.innerHTML;
    if (type === 'html-email') body = E('campaign-html-body').value;

    const sendNow = E('campaign-send-now').checked;
    const schedule = sendNow
      ? new Date().toISOString()
      : E('campaign-schedule').value;

    /* Pabbly payload */
    fetch('https://connect.pabbly.com/workflow/sendwebhookdata/YOUR_URL', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        campaign_id: 'TEMP',
        send_mode: sendNow ? 'now' : 'scheduled',
        scheduled_at: schedule
      })
    });

    console.log({ type, sender, subject, body, schedule });
  }
</script>

</body>
</html>
